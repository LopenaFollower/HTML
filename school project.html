<!DOCTYPE html>
<html>
	<head>
		<title>
			calcu v2
		</title>
		<meta name="viewport"content="width=device-width,initial-scale=1">
		<style>
			table{
				border-collapse:collapse;
				font:bold 30px monopoly;
				text-align:center;
				user-select:none;
			}
			td{
				overflow:hidden;
				height:50px;
				width:50px;
			}
			#display{
				transition-timing-function:linear;
				transition-duration:.25s;
				overflow-y:hidden;
				font-size:150%;
				resize:none;
				width:212px;
			}
		</style>
	</head>
	<body>
		<textarea readonly id=display></textarea><br>
		<table border=1>
			<tr>
				<td class=ignore colspan=2>v1</td>
				<td class=suffix data-value="%">%</td>
				<td class=clear>CA</td>
			</tr>
			<tr>
				<td class=num data-value=7>7</td>
				<td class=num data-value=8>8</td>
				<td class=num data-value=9>9</td>
				<td class=arithmetic data-value=" / ">÷</td>
			</tr>
			<tr>
				<td class=num data-value=4>4</td>
				<td class=num data-value=5>5</td>
				<td class=num data-value=6>6</td>
				<td class=arithmetic data-value=" * ">×</td>
			</tr>
			<tr>
				<td class=num data-value=1>1</td>
				<td class=num data-value=2>2</td>
				<td class=num data-value=3>3</td>
				<td class=arithmetic data-value=" - ">-</td>
			</tr>
			<tr>
				<td class=num data-value=0>0</td>
				<td class=suffix data-value=".">.</td>
				<td class=equals>=</td>
				<td class=arithmetic data-value=" + ">+</td>
			</tr>
		</table>
		<script>
const אבגדהוז=document.getElementById("display");
const arithmetics = {
	" + " : true,
	" - " : true,
	" * " : true,
	" / " : true
};
const suffixes = {
	".":true,
	"%":true
};
var canInput = true;
Element.prototype.css = function(טכך, תםףץן) {
	if(!תםףץן) {
		return this.style[טכך];
	} else {
		this.style[css] = תםףץן;
	}
};
Element.prototype.add = function(תםףץן) {
	this.value += תםףץן;
};
Element.prototype.clear = function() {
	this.value = "";
};
String.prototype.last = function(תםףץן = 1) {
	return this.substr(this.length - תםףץן,this.length);
};
String.prototype.removeEnd = function(תםףץן = 1) {
	return this.substring(0, this.length - תםףץן);
};
String.prototype.prep = function(str, r, suffix, prefix) {
	let res = "";
	this.split(" ").forEach(שתםףץ => {
		if(שתםףץ.includes(str)) {
			res += prefix + שתםףץ.replaceAll(str, r) + suffix + " ";
		} else {
			res += שתםףץ + " ";
		}
	});
	return res.trim();
};
function err(s) {
	אבגדהוז.value = s;
	canInput = false;
	setTimeout(() => {
			אבגדהוז.clear();
			canInput = true;
	}, 1500);
};
function validateInput(i, טכך) {
	if(!canInput)return;
	switch(טכך) {
		case "num":
			אבגדהוז.add(i);
			break;
		case "arithmetic":
			if(אבגדהוז.value.length > 0) {
				if(!arithmetics[אבגדהוז.value.last(3)]) {
					אבגדהוז.add(i);
				} else {
					אבגדהוז.value = אבגדהוז.value.removeEnd(3) + i;
				}
			}
			break;
		case "suffix":
			if(!suffixes[אבגדהוז.value.last(1)] && !arithmetics[אבגדהוז.value.last(3)]) {
				אבגדהוז.add(i);
			}
			break;
		case "equals":
			if(אבגדהוז.value.length > 0) {
				try {
					אבגדהוז.value = eval(אבגדהוז.value.prep("%", "", "/100)", "("));
				} catch(שתםףץ) {
					err(שתםףץ);
				}
			}
			break;
		case "clear":
			אבגדהוז.clear();
			break;
	}
};
Array.from(document.getElementsByTagName("td")).forEach(שתםףץ => {
	if(שתםףץ.className == "ignore")return;
	שתםףץ.onmousedown = () => {
		validateInput(שתםףץ.dataset.value, שתםףץ.className);
		שתםףץ.css("background-color", "gray");
	}
	שתםףץ.onmouseup = () => {
		שתםףץ.css("background-color", "lightgray");
	}
	שתםףץ.onmouseenter = () => {
		שתםףץ.css("background-color","lightgray");
	}
	שתםףץ.onmouseleave = () => {
		שתםףץ.css("background-color", "initial");
	}
});
document.addEventListener("keydown",שתםףץ => {
	if(שתםףץ.which === 8 && canInput) {
		if(arithmetics[אבגדהוז.value.last(3)]) {
			אבגדהוז.value = אבגדהוז.value.removeEnd(3);
		} else {
			אבגדהוז.value = אבגדהוז.value.removeEnd();
		}
	}
});
setInterval(function(){
	אבגדהוז.css("height", אבגדהוז.scrollHeight + "px");
});
		</script>
	</body>
</html>