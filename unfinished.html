<!DOCTYPE html>
<html>
	<head>
		<title>v2</title>
		<style>
			body{
				overflow:hidden;
			}
			#head,.cell_w{
				transition-timing-function:linear;
			}
		</style>
	</head>
	<body bgcolor=#111>
		<script>
const m={
    m:Math,
    n:Number,
    pi:parseInt,
    pf:parseFloat,
    w:window,
    d:document
},b={
	t:true,
	f:false,
	n:null,
	u:undefined
},restrict={
	up:b.f,
	down:b.f,
	left:b.f,
	right:b.f
},js_cd={
	eat:b.t,
	move:b.t
},js_to={
	eat:b.u,
	move:b.u
},
      {floor}=m.m,
      {round}=m.m,
      {random}=m.m,
      {log}=console,
      {sqrt}=m.m,
      {pow}=m.m;
var score=0,
	status=b.f,
	direction,
    speed=350,
	memory_table=[],
	_=true,
	size="25px";
function getElem(id){
    return m.d.getElementById(id)
}
Element.prototype.get=function(css){
	return this.style[css]
}
Element.prototype.set=function(css,v){
	return this.style[css]=v;
}
Element.prototype.add=function(css,v){
	return this.style[css]=m.pf(this.get(css))+v+"px";
}
function magnitude(one,two){
    return sqrt(pow(m.pf(one.style.left)-m.pf(two.style.left),2)+pow(m.pf(one.style.top)-m.pf(two.style.top),2))/m.pf(size);
}
Object.prototype.len=function(){
    return Object.keys(this).length
}
function coords(elem){
    return{x:elem.left,y:elem.top}
}
function spawn(){
    let x={},y={}
    for(let i=1;(x[i-1]?x[i-1]:0)<m.w.innerWidth-m.w.innerWidth%m.pf(size);i++){
        x[i]=i*m.pf(size)
    }
    for(let i=1;(y[i-1]?y[i-1]:0)<m.w.innerHeight-m.w.innerHeight%m.pf(size);i++){
        y[i]=i*m.pf(size)
    }
    let h=m.d.createElement("div"),
        hs=h.style;
    h.id="head"
    hs.width=size;
    hs.height=size;
    hs.backgroundColor="blue";
    hs.borderRadius=m.pf(size)*0.2+"px";
    hs.top=y[floor(random()*(y.len()-1)+1)]+'px';
    hs.left=x[floor(random()*(x.len()-1)+1)]+'px';
    hs.position="fixed";
	hs.zIndex="1";
    hs.WebkitTransitionDuration=speed+25+'ms'
    m.d.body.appendChild(h);
}
function apple(){
    let x={},y={}
    for(let i=1;(x[i-1]?x[i-1]:0)<m.w.innerWidth-m.w.innerWidth%m.pf(size);i++){
        x[i]=i*m.pf(size)
    }
    for(let i=1;(y[i-1]?y[i-1]:0)<m.w.innerHeight-m.w.innerHeight%m.pf(size);i++){
        y[i]=i*m.pf(size)
    }
    let h=m.d.createElement("div"),
        hs=h.style;
    h.id="apple"
    hs.width=size;
    hs.height=size;
    hs.backgroundColor="#f00";
    hs.borderRadius=m.pf(size)*0.4+"px";
    for(let i=0;i<20;i++){
        let chosen_x=x[floor(random()*x.len())],chosen_y=y[floor(random()*y.len())];
        if(chosen_y!=coords(getElem("head")).y){
            hs.top=chosen_y+'px';
        }
        if(chosen_x!=coords(getElem("head")).x){
            hs.left=chosen_x+'px';
        }
    }
    hs.position="fixed";
    hs.zIndex="-1";
    m.d.body.appendChild(h);
}
function make_cell(){
	if(score>0){
		let h=m.d.createElement("div"),
			hs=h.style;
		h.id=""
		h.className="cell_w"
		hs.width=size;
		hs.height=size;
		hs.backgroundColor="#fff";
		hs.borderRadius=m.pf(size)*0.2+"px";
		hs.top='5px';
		hs.left='5px';
		hs.position="fixed";
		hs.zIndex="0"
		hs["transition-timing-function"]="linear"
		hs.WebkitTransitionDuration=speed+50+'ms'
		m.d.body.appendChild(h);
	}
}
function move(dir){
	if(!restrict[dir]){
		direction=dir;
	}
	status=b.t
}
function log_path(newMemory){
	memory_table.reverse()
	memory_table[memory_table.length]=newMemory
	return memory_table.reverse();
}
function ss(elem,string){
	try{
		elem.set("top",string.split(",")[0])
		elem.set("left",string.split(",")[1])
	}catch(e){}
}
m.d.addEventListener("keydown",e=>{
	if(e.keyCode==9){
			e.preventDefault();
		if(getElem("menu").display="none"){
			getElem("menu").display="block"
		}else{
			getElem("menu").display="none"
		}
	}
	if(e.shiftKey||e.altKey||e.ctrlKey)e.preventDefault();
	if(status&&_){
		_=false
		switch(e.keyCode){
			case 87:
				move("up")
				restrict["down"]=b.t
				restrict["left"]=b.f
				restrict["right"]=b.f
				break;
			case 65:
				move("left")
				restrict["down"]=b.f
				restrict["up"]=b.f
				restrict["right"]=b.t
				break;
			case 83:
				move("down")
				restrict["left"]=b.f
				restrict["up"]=b.t
				restrict["right"]=b.f
				break;
			case 68:
				move("right")
				restrict["left"]=b.t
				restrict["up"]=b.f
				restrict["down"]=b.f
				break;
			case 38:
				move("up")
				restrict["down"]=b.t
				restrict["left"]=b.f
				restrict["right"]=b.f
				break;
			case 37:
				move("left")
				restrict["down"]=b.f
				restrict["up"]=b.f
				restrict["right"]=b.t
				break;
			case 40:
				move("down")
				restrict["left"]=b.f
				restrict["up"]=b.t
				restrict["right"]=b.f
				break;
			case 39:
				move("right")
				restrict["left"]=b.t
				restrict["up"]=b.f
				restrict["down"]=b.f
				break;
		}
	}
})
setInterval(()=>{
	if(m.pf(getElem("head").get("top"))<0||m.pf(getElem("head").get("left"))<0||m.pf(getElem("head").get("left"))>m.w.innerWidth-m.w.innerWidth%m.pf(size)||m.pf(getElem("head").get("top"))>m.w.innerHeight-m.w.innerHeight%m.pf(size)){
		status=b.f
		getElem("apple").remove()
		getElem("head").remove()
		if(m.d.getElementsByClassName("cell_w").length>0){
			Array.from(m.d.getElementsByClassName("cell_w")).forEach(e=>{
				e.remove()
			})
		}
		clearTimeout(js_to["eat"])
		clearTimeout(js_to["move"])
		score=0
		direction=b.u
		restrict["left"]=b.f
		restrict["right"]=b.f
		restrict["up"]=b.f
		restrict["down"]=b.f
		spawn();apple()
		js_cd["eat"]=b.t
		js_cd["move"]=b.t
		m.d.title="v2";
	}
	if(magnitude(getElem("head"),getElem("apple"))<1&&js_cd["eat"]&&status){
		js_cd["eat"]=b.f
		m.d.title="v2 - "+(score+1);
		js_to["eat"]=setTimeout(()=>{
			if(status){
				getElem("apple").remove()
				score++
				js_cd["eat"]=b.t
				apple()
			}
		},speed/5);
	}
	if(js_cd["move"]&&status&&direction){
		js_cd["move"]=b.f
		make_cell()
		switch(direction){
			case"up":
				getElem("head").add("top",-m.pf(size));
				break;
			case"down":
				getElem("head").add("top",m.pf(size));
				break;
			case"left":
				getElem("head").add("left",-m.pf(size));
				break;
			case"right":
				getElem("head").add("left",m.pf(size));
				break;
		}
		log_path(getElem("head").get("top")+","+getElem("head").get("left"))
		let id=1;
		if(m.d.getElementsByClassName("cell_w").length>0){
			Array.from(m.d.getElementsByClassName("cell_w")).forEach(e=>{
				e.id=id
				id++
				ss(e,memory_table[e.id])
				if(e.id>score){
					e.remove()
				}
			})
		}
		_=true;
		js_to["move"]=setTimeout(()=>{
			if(status){
				js_cd["move"]=b.t
			}
			speed=300-(score>=50?50:score)*5
		},speed);
	}
},0);
spawn();apple()
		</script>
	</body>
</html>
